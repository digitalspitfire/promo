<!DOCTYPE html>
<!--notes ido:
	Still need to clean the assets/plugin , assets/scripts, assets/img  folders....
-->
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 2.3.2
Version: 1.4
Author: KeenThemes
Website: http://www.keenthemes.com/preview/?theme=metronic
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469
-->
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />

	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<title>Metronic | Admin Dashboard Template</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="assets/plugins/bootstrap/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css"/>
	<link href="assets/plugins/bootstrap/css/bootstrap-responsive-rtl.min.css" rel="stylesheet" type="text/css"/>
	<link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/> <!--icons-->
	<link href="assets/css/style-metro-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/style-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/style-responsive-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/themes/default-rtl.css" rel="stylesheet" type="text/css" id="style_color"/>
	<link href="assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch-metro-rtl.css" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="assets/plugins/chosen-bootstrap/chosen/chosen-rtl.css" />
	<link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-toggle-buttons/static/stylesheets/bootstrap-toggle-buttons-rtl.css" />
	<link rel="shortcut icon" href="favicon.ico" />


	<!-- Ido Styling -->
	<style type="text/css">
		.dataTable .row-details{width: auto; padding-left: 18px;}
		#dashboard > .row-fluid{display:none;}
		#dashboard #managers.row-fluid{min-width: 51.46em;}
		table.nodes thead{display:none;}
		tr.now-deleting{display:none;}
		tr[data-id="-1"] > td {background-color:yellow !important;}
		tr[data-id="-1"] > td > .row-details {display: none;}
		

		.tile .tile-object{bottom:8px;}
		.tile .tile-object .number{font-size:34px;}
		.tile .tile-object .name{font-size:15px;}
		#campaigns .tile,#campaigns .tile:hover{border:none !important; cursor: auto;}
		#tbl-campaigns_wrapper .row-fluid:first-child .span6:first-child{display: none;}
		#tbl-campaigns_wrapper .row-fluid:first-child .span6:nth-child(2){margin-right: 0 !important;}
		table#tbl-campaigns .delete, table#tbl-campaigns .edit{text-decoration: underline; color: blue;}
		table#tbl-campaigns tr.cancelled-campaign a.delete{display:none;}
		table#tbl-campaigns tr.cancelled-campaign td:first-child input:after{content:"dead";}
		#edit-campaign{display: none;}
		input[type="text"]{width: auto;}

		/*temp (solve problem of 2 large managers table */
		/*.portlet-body{overflow: auto;}*/

		.input-line-holder {display: inline-block; padding: 0 20px;}
		#data-upload .portlet-body .control-group{display:none;}
		#data-upload .portlet-body .control-group:first-child{display:block;}
		
	/*scheaduled messages*/
	
	</style>






















</head>
<body class="page-header-fixed">
	<!-- BEGIN HEADER -->   
	<div class="header navbar navbar-inverse navbar-fixed-top">
		<!-- BEGIN TOP NAVIGATION BAR -->
		<div class="navbar-inner">
			<div class="container-fluid">
				<!-- BEGIN LOGO -->
				<a class="brand" href="index.html">
				<img src="assets/img/logo.png" alt="logo" />
				</a>
				<!-- END LOGO -->
				<!-- BEGIN RESPONSIVE MENU TOGGLER -->
				<a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
				<img src="assets/img/menu-toggler.png" alt="" />
				</a>          
				<!-- END RESPONSIVE MENU TOGGLER -->            
				<!-- BEGIN TOP NAVIGATION MENU -->              
				<ul class="nav pull-left">
					<!-- BEGIN USER LOGIN DROPDOWN -->
					<li class="dropdown user">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
						<span class="username">Bob Nilson</span>
						<i class="icon-angle-down"></i>
						</a>
						<ul class="dropdown-menu">
							<li><a href="login.html"><i class="icon-key"></i> Log Out</a></li>
						</ul>
					</li>
					<!-- END USER LOGIN DROPDOWN -->
					<!-- END USER LOGIN DROPDOWN -->
				</ul>
				<!-- END TOP NAVIGATION MENU --> 
			</div>
		</div>
		<!-- END TOP NAVIGATION BAR -->
	</div>
	<!-- END HEADER -->
	<!-- BEGIN CONTAINER -->
	<div class="page-container">
		<!-- BEGIN SIDEBAR -->
		<div class="page-sidebar nav-collapse collapse">
			<!-- BEGIN SIDEBAR MENU -->        
			<ul class="page-sidebar-menu">
				<li data-section="data-upload">
					<a href="#">
						<i class="icon-envelope"></i> 
						<span class="title">קליטת נתונים</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="triggers">
					<a href="#">
						<i class="icon-cogs"></i> 
						<span class="title">טריגרים</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="campaigns">
					<a href="#">
						<i class="icon-cogs"></i> 
						<span class="title">קמפיינים</span>
						<span class="selected"></span>
					</a>
				</li>
			</ul>
			<!-- END SIDEBAR MENU -->
		</div>
		<!-- END SIDEBAR -->
		<!-- BEGIN PAGE -->
		<div class="page-content">
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN STYLE CUSTOMIZER -->
							<!-- IDO DELETED -->
						<!-- END STYLE CUSTOMIZER -->    
						<!-- BEGIN PAGE TITLE & BREADCRUMB-->
						<h3 class="page-title">
							פרומונים
							<small>מעשיות וסיפורים</small>
						</h3>
						<!-- END PAGE TITLE & BREADCRUMB-->
					</div>
				</div>
				<!-- END PAGE HEADER-->
				<div id="dashboard">
					<div class="row-fluid" id="triggers">
						<div class="span12">
							<!-- BEGIN SAMPLE FORM PORTLET-->   
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-cogs"></i>
										<span class="hidden-480">הודעות הנשלחות אוטמטית (טריגרים)</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<div class="form-horizontal">
										<h4>זיהוי משתמשים באמצעות טלפון או WiFi</h4>
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3" name="text" data-trigger-type="recognized"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">מרווח שעות מינמלי בין הודעה להודעה</label>
											<div class="controls">
												<input type="text" name="minInterval" data-trigger-type="recognized"/>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">מצב פעילות:</label>
											<div class="controls">
												<div class="switch switch-small">
													<input checked type="checkbox" checked class="toggle" name="isActive" data-trigger-type="recognized"/>
												</div>
											</div>
										</div>
										<hr>
										<h4>ביטול מנוי</h4>
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3" name="text" data-trigger-type="roost-cancelation"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">מצב פעילות:</label>
											<div class="controls">
												<div class="switch switch-small">
													<input type="checkbox" checked class="toggle" name="isActive" data-trigger-type="roost-cancelation"/>
												</div>
											</div>
										</div>
										<hr>
										<h4>משתמש שביטל נרשם מחדש</h4>
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3" name="text" data-trigger-type="roost-welcome-back"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">שליחת הודעות אוטומטית</label>
											<div class="controls">
												<div class="switch switch-small">
													<input type="checkbox" checked class="toggle" name="isActive" data-trigger-type="roost-welcome-back"/>
												</div>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" id="btn-update-triggers" class="btn blue"><i class="icon-ok"></i> שמור </button>
										</div>
									</div>
									<!-- END FORM-->  
								</div>
							</div>
							<!-- END SAMPLE FORM PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="data-upload"><!--zz-->
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box light-grey">
							<div class="portlet-title">
								<div class="caption"><i class="icon-globe"></i>העלאת קובץ חדש</div>
							</div>
							<div class="portlet-body form">
								<div class="form-horizontal">
									<div class="control-group" id="file-upload">
										<form action="/api/dataFileUpload/1" method="post" enctype="multipart/form-data" id="form-data-file-upload">
											<label class="control-label">בחירת קובץ</label>
											<div class="controls">
												<input type="file" name="dataFile" id="dataFile">
											</div>
										</form>
										<button id="btn-upload-file" class="btn green">
											העלה קובץ <i class="icon-plus"></i>
										</button>
									</div>
									<div class="control-group" id="data-settings" >
										<div class="controls" id="cellular-column"></div>
										<div class="controls" id="selected-columns"></div>
										<div class="controls">
											<button id="btn-present-data" type="button" class="btn blue">הצג מידע</button>
											<button type="button" class="btn red btn-restart-data-upload">בחר קובץ אחר</button>
										</div>
									</div>
									<div class="control-group" id="data-present">
										<div class="controls">
											<div class="portlet-body">
												<table class="table table-striped table-hover" id="tbl-present-data">
													<thead></thead>
													<tbody></tbody>
												</table>
											</div>	
										</div>
										<div class="controls">
											<button id="btn-update-users-data" type="button" class="btn blue">עדכן מסד נתונים</button>
											<button type="button" class="btn red btn-restart-data-upload">בחר קובץ אחר</button>
										</div>
									</div>
									<div class="control-group" id="data-upload-approve">
										<div class="controls">המידע נשמר בהצלחה</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="campaigns">
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box light-grey" id="campaigns-list">
							<div class="portlet-title">
								<div class="caption"><i class="icon-globe"></i>כל הקמפיינים</div>
							</div>
							<div class="portlet-body">
								<div class="table-toolbar">
									<div class="btn-group">
										<button id="add-new-campaign" class="btn green">
											Add New <i class="icon-plus"></i>
										</button>
									</div>
								</div>
								<table class="table table-striped table-bordered table-hover" id="tbl-campaigns">
									<thead>
										<tr>
											<th data-field="name">שם</th>
											<th data-field="category">קטגוריה</th>
											<th data-field="is_active">סטטוס</th>											
											<th>עריכה</th>
											<th>מחיקה</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
						<div class="portlet box blue" id="edit-campaign" data-id="1">
							<div class="portlet-title">
								<div class="caption">
									<i class="icon-reorder"></i> עריכת קמפיין
								</div>
								<div class="tools hidden-phone">
									<a href="javascript:;" class="collapse"></a>
									<a href="#portlet-config" data-toggle="modal" class="config"></a>
									<a href="javascript:;" class="reload"></a>
									<a href="javascript:;" class="remove"></a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="form-horizontal">
									<div class="form-wizard">
										<div class="navbar steps">
											<div class="navbar-inner">
												<ul class="row-fluid">
													<li class="span3 active">
														<a href="#tab1" data-toggle="tab" class="step active">
															<span class="number">1</span>
															<span class="desc"><i class="icon-ok"></i> ראשי</span>   
														</a>
													</li>
													<li class="span3">
														<a href="#tab2" data-toggle="tab" class="step">
															<span class="number">2</span>
															<span class="desc"><i class="icon-ok"></i>עריכת תוכן, תזמון, הפעלה</span>   
														</a>
													</li>
													<li class="span3">
														<a href="#tab3" data-toggle="tab" class="step">
															<span class="number">3</span>
															<span class="desc"><i class="icon-ok"></i> תוצאות</span>   
														</a>
													</li>
												</ul>
											</div>
										</div>
										<div class="tab-content">
											<div class="alert alert-error hide">
												<button class="close" data-dismiss="alert"></button>
												You have some form errors. Please check below.
											</div>
											<div class="alert alert-success hide">
												<button class="close" data-dismiss="alert"></button>
												Your form validation is successful!
											</div>
											<div class="tab-pane active" id="tab1">
												<h3 class="block">ראשי</h3>
												<div class="control-group">
													<label class="control-label">פעיל</label>
													<div class="controls">
														<div class="input-line-holder">
															<label class="checkbox line">
																<input type="checkbox" name="isActive" id="isActive" value="1" /> 
															</label>
														</div>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">שם הקמפיין</label>
													<div class="controls">
														<input type="text" class="span4 m-wrap" name="name" id="name"/>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">תאריך יצירה</label>
													<div class="controls">
														<input type="text" class="span4 m-wrap" name="createdAt" disabled/>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">קטגוריה</label>
													<div class="controls">
														<input type="text" class="span4 m-wrap" name="category" id="category"/>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">יעדים</label>
													<div class="controls">
														<textarea class="span6 m-wrap" rows="3" name="goals" id="goals"></textarea>
													</div>												
												</div>
												<div class="control-group">
													<label class="control-label">תקציב</label>
													<div class="controls">
														<input type="text" class="span4 m-wrap" name="budget" id="budget"/>
													</div>
												</div>
											</div>
											<div class="tab-pane" id="tab2">
												<h3 class="block">עריכת תוכן ותזמון</h3>
												<div class="control-group">
													<label class="control-label">הודעה</label>
													<div class="controls">
														<textarea class="span6 m-wrap" rows="3" name="message"></textarea>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">לינק</label>
													<div class="controls">
														<input type="text" class="span4 m-wrap" name="link" id="link"/>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">צליל</label>
													<div class="controls">
														<select name="sound" id="sound" class="span3">
															<option value="">Select</option>
															<option value="alarm">alarm</option>
															<option value="alarm">bell</option>
															<option value="ring">ring</option>
														</select>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">תזמון</label>
													<div class="controls">
														<select name="recurring" id="recurring" class="span3">
															<option value="0">חד פעמי</option>
															<option value="1">יומי</option>
															<option value="2">שבועי</option>
														</select>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">שעה</label>
													<div class="controls">
														<select name="dayOfWeek" id="dayOfWeek" class="span3">
															<option value="0">ראשון</option>
															<option value="1">שני</option>
															<option value="2">שלישי</option>
															<option value="3">רביעי</option>
															<option value="4">חמישי</option>
															<option value="5">שישי</option>
															<option value="6">שבת</option>
														</select>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">שעה</label>
													<div class="controls">
														<select name="hour" id="hour" class="span3">
															<option value="0">0:00</option>
															<option value="1">1:00</option>
															<option value="2">2:00</option>
															<option value="3">3:00</option>
															<option value="4">4:00</option>
															<option value="5">5:00</option>
															<option value="6">6:00</option>
															<option value="7">7:00</option>
															<option value="8">8:00</option>
															<option value="9">9:00</option>
															<option value="10">10:00</option>
															<option value="11">11:00</option>
															<option value="12">12:00</option>
															<option value="13">13:00</option>
															<option value="14">14:00</option>
															<option value="15">15:00</option>
															<option value="16">16:00</option>
															<option value="17">17:00</option>
															<option value="18">18:00</option>
															<option value="19">19:00</option>
															<option value="20">20:00</option>
															<option value="21">21:00</option>
															<option value="22">22:00</option>
															<option value="23">23:00</option>
														</select>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label">מבוסס מיקום</label>
													<div class="controls">
														<div class="input-line-holder">
															<label class="checkbox line">
																<input type="checkbox" name="isRoostGeoLoc" value="1" /> 
															</label>
														</div>
													</div>
												</div>
											</div>
											<div class="tab-pane" id="tab3">
												<h3 class="block">סטטיסטיקה</h3>
												<div class="tiles">
													<div class="tile bg-blue" id="roost-history">
														<div class="tile-body">
															<i class="icon-bell"></i>
														</div>
														<div class="tile-object">
															<div class="name">
																PUSH
															</div>
															<div class="number"></div>
														</div>
													</div>
												</div>
												<div class="tile bg-green" id="sms-history">
													<div class="tile-body">
														<i class="icon-comments-alt"></i>
													</div>
													<div class="tile-object">
														<div class="name">
															SMS
														</div>
														<div class="number"></div>
													</div>
												</div>
											</div>
										</div>
										<div class="form-actions clearfix">
											<a href="javascript:;" class="btn button-previous" id="btn-all-campaings">
											<i class="m-icon-swapleft"></i> חזרה לכל הקמפיינים
											</a>
											<a href="javascript:;" class="btn green button-submit" id="btn-save-campaign">
											שמור שינויים <i class="m-icon-swapright m-icon-white"></i>
											</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- END PAGE CONTAINER-->    
		</div>
		<!-- END PAGE -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	<div class="footer">
		<div class="footer-inner">
			2013 &copy; Metronic by keenthemes.
		</div>
	</div>
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->   
	<script src="assets/plugins/jquery-1.10.1.min.js" type="text/javascript"></script>
	<!--
	<script src="assets/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script> //removed for deployment
	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="assets/plugins/jquery-ui/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>      
	<script src="assets/plugins/bootstrap/js/bootstrap-rtl.min.js" type="text/javascript"></script>
	<!--
	<script src="assets/plugins/bootstrap-hover-dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript" ></script>
	<!--[if lt IE 9]>
	<script src="assets/plugins/excanvas.min.js"></script>
	<script src="assets/plugins/respond.min.js"></script>  
	<![endif]-->   
	
	<!--<script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>-->
	<script src="assets/plugins/jquery.blockui.min.js" type="text/javascript"></script>  

	<!--<script src="assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript" ></script>-->
	<!-- END CORE PLUGINS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<!--
	<script src="assets/plugins/flot/jquery.flot.js" type="text/javascript"></script>
	<script src="assets/plugins/flot/jquery.flot.resize.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery.pulsate.min.js" type="text/javascript"></script>
	<script src="assets/plugins/bootstrap-daterangepicker/date.js" type="text/javascript"></script>
	<script src="assets/plugins/bootstrap-daterangepicker/daterangepicker-rtl.js" type="text/javascript"></script>     
	<script src="assets/plugins/gritter/js/jquery.gritter.js" type="text/javascript"></script>
	<script src="assets/plugins/fullcalendar/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-easy-pie-chart/jquery.easy-pie-chart.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
	-->
	<script src="assets/plugins/bootstrap-switch/static/js/bootstrap-switch.js" type="text/javascript" ></script><!-- for ON/Off switch -->  
	
	 <script src="assets/plugins/mustache.js" type="text/javascript"></script> <!-- mustache -->
	 <script src="assets/plugins/jquery.ba-throttle-debounce.js" type="text/javascript"></script> <!-- jquery throtle -->
	
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!--<script src="assets/scripts/table-editable.js"></script>-->
	<script type="text/javascript" src="assets/plugins/bootstrap-toggle-buttons/static/js/jquery.toggle.buttons.js"></script>
	<!-- END PAGE LEVEL SCRIPTS -->
	
	<!-- BEGIN EDITABLE TABLE SCRIPTS (ido)-->
	<!--
	<script type="text/javascript" src="assets/plugins/select2/select2.min.js"></script>
	-->

	<script type="text/javascript" src="assets/plugins/data-tables/jquery.dataTables.js"></script>
	<script type="text/javascript" src="assets/plugins/data-tables/DT_bootstrap.js"></script>












	<!-- END EDITABLE TABLE SCRIPTS -->
	<!-- BEGIN IDO JS: -->
	<script type="text/javascript" src="js/jquery.jeditable.js"></script>
	<script type="text/javascript" src="js/jquery.blockui.js"></script>
	<script src="assets/scripts/app.js"></script>     
	<script src="assets/scripts/form-wizard.js"></script>     
	<!--<script src="assets/scripts/table-managed.js"></script>     -->
	<!--NAVIGATION SCRIPT-->
	<script>
		$('.page-sidebar-menu li').on('click', function(){
			$('.page-sidebar-menu li').removeClass('active');
			$(this).addClass('active');
			
			$('#dashboard > .row-fluid').hide();
			var section = $(this).attr('data-section'); 
			$('#dashboard #' + section + '.row-fluid').fadeIn();
		});
		
		$(document).ready(function(){
			$('.page-sidebar-menu li:nth-child(3)').trigger('click');
		});
	</script>

	<!--CAMPAIGNS -->
	<script>
	function prependCampaignRow(c){	 // return to prependCampaignRow(c, newRow)
		var newCampaign = {
			days: [
				{value:0, label:'ראשון'},
				{value:1, label:'שני'},
				{value:2, label:'שלישי'},
				{value:3, label:'רביעי'},
				{value:4, label:'חמישי'},
				{value:5, label:'שישי'},
				{value:6, label:'שבת'},
			],
			hours: [{value:0},{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7},{value:8},{value:9},{value:10},{value:11},{value:12},{value:13},{value:14},{value:15},{value:16},{value:17},{value:18},{value:19},{value:20},{value:21},{value:22},{value:23}],
			messageSounds:[{value:'0', label:'bell'},{value:1,label:'ring'},{value:2,label:'alarm'}],
		};
		$.extend(newCampaign,{id:c.id, isActive:c.is_active,messageText:c.message_text, messageLink:c.message_link, isRecurring:c.isRecurring, filters:c.filters, isCancelled:c.is_cancelled});
		$.extend(newCampaign.days[c.day_of_week],{isSelected:true});
		$.extend(newCampaign.hours[c.hour],{isSelected:true});
		$.extend(newCampaign.messageSounds[c.message_sound],{isSelected:true});
		console.log(newCampaign);
		var partials = {
			isActive: '<td><input type="checkbox" {{#isActive}}checked="checked"{{/isActive}} class="toggle"/></td>',
			dayOption:'<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{label}}</option>',
			hourOption:'<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{value}}:00</option>',
			soundOption: '<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{label}}</option>',
			isRecurring: '<td><input type="checkbox" {{#isRecurring}}checked="checked"{{/isRecurring}} class="toggle"/></td>',
			messageText: '<td><textarea>{{messageText}}</textarea></td>',
			messageLink: '<td><input type="text" value="{{messageLink}}"></td>',
			//filter:'{{#.}}{{name}}{{/.}}<select><option value="0">no filter</option>{{#.}}<option {{#isSelected}}selected{{/isSelected}}>{{value}}</option>{{/.}}</select>', //When we will filter values...
			filters:'<td><div>{{#filters}}<div>{{.}}</div>{{/filters}}</div></td>',
			deleteLink: '</td><td><a id="delete-{{id}}" class="delete" href="#">Delete</a></td>'
		};
		
		var campaignRow = Mustache.render('<tr class="campaign{{#isCancelled}} cancelled-campaign{{/isCancelled}}" data-id="{{id}}">{{>isActive}}<td ><select class="chosen">{{#days}}{{>dayOption}}{{/days}}</select></td><td><select class="chosen">{{#hours}}{{>hourOption}}{{/hours}}</select></td>{{>isRecurring}}{{>messageText}}{{>messageLink}}<td><select class="chosen">{{#messageSounds}}{{>soundOption}}{{/messageSounds}}</select></td>{{>filters}}{{>deleteLink}}</tr>', newCampaign,partials);

		$('#tbl-campaigns tbody').prepend(campaignRow);		
		//TODO add nice toggle buttons to isRecurring

		var currentRow = $('#tbl-campaigns>tbody>tr:first-child');
		var id = currentRow.attr('data-id'); 
		if (id=="") {//saving the new row it will get an ID 
			$.ajax({
				type: "post",
				url: '/api/1/campaigns/',				
				data: newCampaign,
				success: function(response) {
					console.log(response);
					var newRow = $($('#tbl-campaigns tr[data-id=""]')[0]);
					newRow.attr('data-id',response);
					currentRow.on('keyup change', 'input,textarea,select', $.debounce(2000, updateCampaign));//TODO I changed it here but not in the server now the server functions can be narrowed down :))
				}
			});
		}
		else{currentRow.on('keyup change', 'input,textarea,select', $.debounce(2000, updateCampaign));}
	}	
	function updateCampaign(campaignId){
		var campaignRow = $($(this).parents('tr.campaign')[0]); 
		var campaignId = campaignRow.attr('data-id');		
		var campaignData = {};
		
		campaignRow.children('td').children('input[type="text"]').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		campaignRow.children('td').children('input[type="checkbox"]').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			if($(this).is(':checked')){campaignData[fieldName] = true;}
			else{campaignData[fieldName] = false;}
		});
		campaignRow.children('td').children('select').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		campaignRow.children('td').children('textarea').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		console.log(campaignRow);
		console.log('before send:');
		console.log(campaignId);
		console.log(campaignData);
		$.ajax({
			type: "post",
			url: '/api/1/campaigns/'+campaignId,				
			data: campaignData,
			success: function(response) {
				console.log(response);
			}
		});
	}
	function getParameterByName(name) {
	    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
	    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	        results = regex.exec(location.search);
	    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}

	/*
	$('#form-data-file-upload').submit(function(e){
	    var postData = $(this).serializeArray();
	    var formURL = $(this).attr("action");
	    $.ajax(
	    {
	        url : formURL,
	        type: "POST",
	        data : postData,
	        success:function(data, textStatus, jqXHR) 
	        {
	            //data: return data from server
	            alert(data);
	        },
	        error: function(jqXHR, textStatus, errorThrown) 
	        {
	            //if fails      
	            alert(textStatus);
	        }
	    });
	    e.preventDefault(); //STOP default action
	});
*/



	//Campaigns:
	function loadCampaigns(managerId,campaignId){
		var id = campaignId ? campaignId : '';
		if(id){
			console.log('got to first');
			var parseCampaigns = function(data){
				console.log('campaign data: '+data);
				var wizard = $('#edit-campaign');
				wizard.attr('data-id',campaignId);
				var textInputs = wizard.find('input[type="text"]');
				var chbxInputs = wizard.find('input[type="checkbox"]');
				var selectInputs = wizard.find('select');
				var textAreas = wizard.find('textarea');
				$.each(textInputs, function(index,i){
					i = $(i);
					var fieldName = i.attr('name');
					i.val(data[fieldName]);
				});
				$.each(chbxInputs, function(index,i){
					i = $(i);
					var fieldName = i.attr('name');
					i.prop('checked', data[fieldName] ? true : false);
				});
				$.each(selectInputs, function(index,i){
					i=$(i);
					var fieldName = i.attr('name');
					if(data[fieldName]){i.val(data[fieldName]);}
					console.log(fieldName +': '+data[fieldName]);
				});
				$.each(textAreas, function(index,i){
					i=$(i);
					var fieldName = i.attr('name');
					i.val(data[fieldName]);				
				});
				var sent = JSON.parse(data.sent);
				$('#sms-history .number').html(sent.sms);
				$('#roost-history .number').html(sent.roost);
			}
		}else{
			console.log('got to secind');
			$('#tbl-campaigns > tbody').html('');
			var parseCampaigns =  function(data){
				console.log('campaings data: '+data);
				var tbody = $('#tbl-campaigns > tbody');
				$.each(data,function(i,c){
					var cRow = '<tr class="campaign" data-id="'+c.id+'"><td>'+c.name+'</td><td>'+c.category+'</td><td>'+c.isActive+'</td><td><a class="edit">Edit</a></td><td><a class="delete">Delete</a></td></tr>';
					tbody.append(cRow);
					console.log(c);
				});
				$('#tbl-campaigns').dataTable( {
    				"bFilter": true,
    				"bInfo": false,
    				"bPaginate": false,
		    		"oLanguage": {
		   				 "sSearch": "חיפוש: "
		  			}
  				});
			}
		}
		
		$.ajax({
			type: "get",
			url: '/api/campaigns/'+managerId+'/'+id,
			success: parseCampaigns
		});
	}
	$(function(){
		App.init();
//	    TableManaged.init();
		

		if(getParameterByName('uploaded')=='true'){
			
			$('#data-upload .portlet-body .control-group').hide();
			$('#data-upload .portlet-body .control-group#data-settings').show();
			
			$.ajax({
				type: "get",
				url: '/api/getCsvHeaders/1',				
				success: function(response){
					if(!response){response='empty';}
					console.log('columns received: '+response);
					$('#cellular-column').html('<div class="input-line-holder">מאפיין סללורי</div>');
					$('#selected-columns').html('<div class="input-line-holder">עמודות רצויות</div>');
					$.each(response, function(i,h){
						var strRadios = '<div class="input-line-holder"><label class="radio"><input type="radio" name="cellular-column" value="'+i+'" />'+h+'</label></div>';
						$('#cellular-column').append(strRadios);
						var strChbks = '<div class="input-line-holder"><label class="checkbox"><input type="checkbox" name="selected-columns" value="'+i+'" />'+h+'</label></div>';
						$('#selected-columns').append(strChbks);
					});
				}	
			});
		}
		$('#btn-upload-file').on('click',function(){$('#form-data-file-upload').submit();});

		$('#btn-present-data').on('click',function(){
			var cellularColumn = $("#cellular-column input[type='radio']:checked");
			if (cellularColumn.length > 0) {cellularColumn = cellularColumn.val();}
			else{cellularColumn='';}
    		var selectedColumns='';
    		selectedColumns = $('#selected-columns input[type=checkbox]:checked').map(function(){
                return $(this).val();
            }).get();
            console.log('before send: '+cellularColumn);
            console.log('before send: '+selectedColumns);
            console.log(selectedColumns.indexOf(cellularColumn));
            if(!cellularColumn){alert('חובה לבחור שדה סללורי'); return false;}
            if(!(selectedColumns.indexOf(cellularColumn) > -1)){alert('עמודת מאפיין סללורי חייבת להיבחר'); return false;}

            $.ajax({
				type: "post",
				url: '/api/presentData/1',				
				data: {celCol: cellularColumn,selectedCols:selectedColumns},
				success: function(rows){
					
					console.log('organized data: '+rows);
					$.each(rows, function(i,r){						
						if(i==0){
							var dataRow = '<tr>';
							$.each(r, function(j,c){								
								dataRow +='<td>'+c+'</td>';
							});
							dataRow += '</tr>';
							$('#tbl-present-data thead').html(dataRow);
						}else{
							var dataRow = '<tr>';
							$.each(r, function(j,c){								
								dataRow +='<td>'+c+'</td>';
							});
							dataRow += '</tr>';
							$('#tbl-present-data tbody').append(dataRow);
						}
					});
					$('#data-upload .portlet-body .control-group').hide();
					$('#data-upload .portlet-body .control-group#data-present').show();
				}	
			});
		});
		$('#btn-update-users-data').on('click',function(){
			$.ajax({
				type: "get",
				url: '/api/update-users-data/1',				
				//data: {celCol: cellularColumn,selectedCols:selectedColumns},
				success: function(rows){
					$('#data-upload .portlet-body .control-group').hide();
					$('#data-upload .portlet-body .control-group#data-upload-approve').show();
				}	
			});
		});
		$('.btn-restart-data-upload').on('click',function(){
			console.log(window.location.href);
			window.location.replace(window.location.href.split('?')[0]);
		});
		$('#tbl-campaigns').on('click','a.delete-campaign',function(){
			$(this).parents('tr')[0].remove();
			updateManagerCampaigns();
		});		
		//$('#tbl-campaigns').on('change','select, input[type="checkbox"]',$.debounce(2000, updateManagerCampaigns));		
		//$('#tbl-campaigns').on('keyup','textarea',$.debounce(2000, updateManagerCampaigns));		


		//Getting manager's campaigns:
		var managerId = getParameterByName('managerId');
		/*
		$.ajax({
			type:"get",
			url:'api/1/campaigns/'+managerId, //TODO dynamic managerId  //TODO very bad loop fix with Ilan
			success: function(campaigns){
				console.log('hey');
				console.log(campaigns);
				$.each(campaigns,function(index,c){prependCampaignRow(c);});
			},
			error:function(){console.log('b');}
		});
		*/

		/*===============CAMPAIGN==========*/
		//Load campagin list:
		$('#btn-all-campaings').on('click',function(){ //TODO add dynamic managerId
			loadCampaigns(1);
			$('#campaigns-list').show();
			$('#edit-campaign').hide();

		}); 
		//Add new campaign:
		$('#add-new-campaign:not(.creating-campaign)').on('click',function(){
			$(this).addClass('creating-campaign');
			$.ajax({
					type: "post",
					url: '/api/campaigns/1',	//TODO add dynamic managerId
					data: {},
					success: function(newId) {
						alert(newId);
						console.log(newId);
						loadCampaigns(1,newId);	//TODO this could be made with just one call...					
						$('#campaigns-list').hide();
						$('#edit-campaign').show();
					}
				});
		});
		//load single campagin
		loadCampaigns(1);
		//save campaign:
		$('#btn-save-campaign').on('click',function(){
			var data = {};
			var wizard = $($(this).parents('#edit-campaign')[0]);
			var id= wizard.attr('data-id');
			var chbxInputs = wizard.find('input[type="checkbox"]');
			var textInputs = wizard.find('input[type="text"]');
			var selectInputs = wizard.find('select');
			var textAreas = wizard.find('textarea');
			$.each(textInputs, function(index,i){
				i = $(i);
				if(!i.is(':disabled')){
					var fieldName = i.attr('name');
					data[fieldName]=i.val();
				}
			});
			$.each(chbxInputs, function(index,i){
				i = $(i);
				var fieldName = i.attr('name');
				data[fieldName]=i.is(':checked') ? 1 : 0;
			});
			$.each(selectInputs, function(index,i){
				i=$(i);
				var fieldName = i.attr('name');
				data[fieldName] = $(i.children('option:selected')[0]).attr('value');
				console.log('select found---'+fieldName);
			});
			$.each(textAreas, function(index,i){
				i=$(i);
				var fieldName = i.attr('name');
				data[fieldName] = i.val();				
			});
			console.log(data);
			if(id>0){
				console.log('ajax');
				$.ajax({
					type: "post",
					url: '/api/campaigns/1/'+id,	//TODO add dynamic managerId
					data: data,
					success: function(response) {
						console.log(response);
						//TODO add an "saved" notification
					}
				});
			}
		});
		$('#tbl-campaigns').on('click','.edit',function(){
			var campaignId = $($(this).parents('tr')[0]).attr('data-id');
			console.log(campaignId);
			loadCampaigns(1,campaignId);
			$('#campaigns-list').hide();
			$('#edit-campaign').show();
		});
		$('#tbl-campaigns').on('click','.delete',function(){
			var campaignId = $($(this).closest('tr')[0]).attr('data-id');
			console.log('before delete -campaignId: '+campaignId);
			$.ajax({
				type: "delete",
				url: '/api/campaigns/'+getParameterByName('managerId')+'/'+campaignId,
				success: function(deletedId){console.log('deleted! id: '+deletedId);}
			});
			$($(this).parents('tr')[0]).remove();
		});


		//TRIGGERS SECTION:
		var triggers=[];
		$.ajax({
			type: "get",
			url: '/api/triggers/'+managerId,				
			success: function(data){
				
				if(data){
					
					$.each(data,function(i,t){						
						console.log('triggers:');		
						console.log(t);
						$('textarea[name=text][data-trigger-type='+t.type+']').val(t.text);
						$('input[name=minInterval][data-trigger-type='+t.type+']').val(t.minInterval);
						if(!t.isActive){
							alert(t.type+' not active');
							$('input[name=isActive][data-trigger-type='+t.type+']').prop('checked',false);	
							$('input[name=isActive][data-trigger-type='+t.type+']').parent().removeClass('switch-on').addClass('switch-off'); //TODO- this should happen automatically !!!
						}
					});
				}
				//$('input[name=isActive][data-trigger-type=recognized]').prop('checked',true);	
				//$('input[name=isActive][data-trigger-type=recognized]').addClass('ido');	
			}	
		});
		$('#btn-update-triggers').on('click',function(){
			var data =[];
			$.each($(['recognized','roost-cancelation','roost-welcome-back']),function(i,type){						
				var trigger={};
				trigger.type=type;
				trigger.text=$('textarea[name=text][data-trigger-type='+type+']').val();
				trigger.minInterval=$('input[name=minInterval][data-trigger-type='+type+']').val();
				//trigger.isActive=fa
				if($('input[name=isActive][data-trigger-type='+type+']').is(":checked")){alert(type+ ': true')};
				data.push(trigger);
			});
			$.ajax({
				type: "post",
				url: '/api/triggers/'+managerId,				
				data:JSON.stringify(data)
				success: function(data){
					alert('yo');
				}
			});
		});
		//TRIGGERS SECTION---END
	});
	</script>
	<!-- Ido Styling END-->
	
	<!-- new plugin End-->
	
	<!-- END JAVASCRIPTS -->
	
</body>
<!-- END BODY -->
</html>