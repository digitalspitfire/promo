<!DOCTYPE html>
<!--notes ido:
	Still need to clean the assets/plugin , assets/scripts, assets/img  folders....
-->
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 2.3.2
Version: 1.4
Author: KeenThemes
Website: http://www.keenthemes.com/preview/?theme=metronic
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469
-->
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<title>Metronic | Admin Dashboard Template</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="assets/plugins/bootstrap/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css"/>
	<link href="assets/plugins/bootstrap/css/bootstrap-responsive-rtl.min.css" rel="stylesheet" type="text/css"/>
	<link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/> <!--icons-->
	<link href="assets/css/style-metro-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/style-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/style-responsive-rtl.css" rel="stylesheet" type="text/css"/>
	<link href="assets/css/themes/default-rtl.css" rel="stylesheet" type="text/css" id="style_color"/>
	<link href="assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch-metro-rtl.css" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="assets/plugins/chosen-bootstrap/chosen/chosen-rtl.css" />
	<link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-toggle-buttons/static/stylesheets/bootstrap-toggle-buttons-rtl.css" />
	<link rel="shortcut icon" href="favicon.ico" />
</head>
<body class="page-header-fixed">
	<!-- BEGIN HEADER -->   
	<div class="header navbar navbar-inverse navbar-fixed-top">
		<!-- BEGIN TOP NAVIGATION BAR -->
		<div class="navbar-inner">
			<div class="container-fluid">
				<!-- BEGIN LOGO -->
				<a class="brand" href="index.html">
				<img src="assets/img/logo.png" alt="logo" />
				</a>
				<!-- END LOGO -->
				<!-- BEGIN RESPONSIVE MENU TOGGLER -->
				<a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
				<img src="assets/img/menu-toggler.png" alt="" />
				</a>          
				<!-- END RESPONSIVE MENU TOGGLER -->            
				<!-- BEGIN TOP NAVIGATION MENU -->              
				<ul class="nav pull-left">
					<!-- BEGIN USER LOGIN DROPDOWN -->
					<li class="dropdown user">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
						<span class="username">Bob Nilson</span>
						<i class="icon-angle-down"></i>
						</a>
						<ul class="dropdown-menu">
							<li><a href="login.html"><i class="icon-key"></i> Log Out</a></li>
						</ul>
					</li>
					<!-- END USER LOGIN DROPDOWN -->
					<!-- END USER LOGIN DROPDOWN -->
				</ul>
				<!-- END TOP NAVIGATION MENU --> 
			</div>
		</div>
		<!-- END TOP NAVIGATION BAR -->
	</div>
	<!-- END HEADER -->
	<!-- BEGIN CONTAINER -->
	<div class="page-container">
		<!-- BEGIN SIDEBAR -->
		<div class="page-sidebar nav-collapse collapse">
			<!-- BEGIN SIDEBAR MENU -->        
			<ul class="page-sidebar-menu">
				<li class="start active " data-section="managers">
					<a href="#">
						<i class="icon-user"></i> 
						<span class="title">ניהול משתמשים</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="messages">
					<a href="#">
						<i class="icon-envelope"></i> 
						<span class="title">שליחת הודעות</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="timers">
					<a href="#">
						<i class="icon-cogs"></i> 
						<span class="title">הגדרות טיימרים</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="dynamic-fields">
					<a href="#">
						<i class="icon-sitemap"></i> 
						<span class="title">שדות דינאמיים</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="auto-messages">
					<a href="#">
						<i class="icon-envelope"></i> 
						<span class="title">הגדרת הודעה אוטומטית-מנהל זוטר</span>
						<span class="selected"></span>
					</a>
				</li>
				<li data-section="campaigns">
					<a href="#">
						<i class="icon-cogs"></i> 
						<span class="title">הודעה יזומה- מנהל זוטר</span>
						<span class="selected"></span>
					</a>
				</li>
			</ul>
			<!-- END SIDEBAR MENU -->
		</div>
		<!-- END SIDEBAR -->
		<!-- BEGIN PAGE -->
		<div class="page-content">
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN STYLE CUSTOMIZER -->
							<!-- IDO DELETED -->
						<!-- END STYLE CUSTOMIZER -->    
						<!-- BEGIN PAGE TITLE & BREADCRUMB-->
						<h3 class="page-title">
							פרומונים
							<small>מעשיות וסיפורים</small>
						</h3>
						<!-- END PAGE TITLE & BREADCRUMB-->
					</div>
				</div>
				<!-- END PAGE HEADER-->
				<div id="dashboard">
					<div class="row-fluid" id="timers">
						<div class="span12">
							<!-- BEGIN SAMPLE FORM PORTLET-->   
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-cogs"></i>
										<span class="hidden-480">הגדרת טיימרים של המערכת</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="control-group">
											<label class="control-label">אינטרבל עדכון ביטולים</label>
											<div class="controls">
												<input type="text" placeholder="" class="m-wrap small" />
												<span class="help-inline">הכנס מספר שניות</span>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">אינטרבל Recognizing</label>
											<div class="controls">
												<input type="text" placeholder="" class="m-wrap small" />
												<span class="help-inline">הכנס מספר שניות</span>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue"><i class="icon-ok"></i>שמור </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<!-- END SAMPLE FORM PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="messages">
						<div class="span12">
							<!-- BEGIN SAMPLE FORM PORTLET-->   
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-envelope"></i>
										<span class="hidden-480">שליחת נוטיפיקציות/סמסים</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3" id="sms-text"></textarea>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue" id="send-sms"><i class="icon-ok"></i> שלח </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<!-- END SAMPLE FORM PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="managers">
						<div class="span12">
							<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption">
									<i class="icon-user"></i>
									<span class="hidden-480">ניהול משתמשים</span>
								</div>
							</div>
							<div class="portlet-body">
								<table class="table table-striped table-hover table-bordered dataTable vendors" id="vendors-table"><!--added the type to element class-->
									<thead>
										<tr>
											<th data-field="vendor">שם החברה</th>
											<th data-field="name">שם המנהל</th>
											<th data-field="phone">טלפון</th>
											<th data-field="email">אימייל</th>
											<th data-field="ivr_phone">טלפון בIVR</th>
											<th data-field="roost_config_key">Roost Config Key</th>
											<th data-field="roost_secret_key">Roost Secret Key</th>
											<th data-field="user_name">שם מתשמש</th>
											<th data-field="password">סיסמה</th>
											<th data-field="nodes">Nodes</th>
											<th >מחק</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
								<div class="table-toolbar">
									<div class="btn-group">
										<button class="btn green add-new-vendor">
										Add New <i class="icon-plus"></i>
										</button>
									</div>
								</div>
							</div>
						</div>
						<!-- END EXAMPLE TABLE PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="dynamic-fields">
						<div class="span12">
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-user"></i>
										<span class="hidden-480">ניהול משתמשים</span>
									</div>
								</div>
								<div class="portlet-body">
									<div class="table-toolbar">
										<div class="btn-group">
											<button class="btn green add-new-vendor">
											Add New <i class="icon-plus"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="auto-messages">
						<div class="span12">
							<!-- BEGIN SAMPLE FORM PORTLET-->   
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-cogs"></i>
										<span class="hidden-480">Sniffing</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">שליחת הודעות אוטומטית</label>
											<div class="controls">
												<div class="switch switch-small">
													<input type="checkbox" checked class="toggle"/>
												</div>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue"><i class="icon-ok"></i> שמור </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-cogs"></i>
										<span class="hidden-480">ביטול מנוי</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">שליחת הודעות אוטומטית</label>
											<div class="controls">
												<div class="switch switch-small">
													<input type="checkbox" checked class="toggle"/>
												</div>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue"><i class="icon-ok"></i> שמור </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-cogs"></i>
										<span class="hidden-480">משתמש שביטל נרשם מחדש</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="control-group">
											<label class="control-label">תוכן ההודעה</label>
											<div class="controls">
												<textarea class="medium m-wrap" rows="3"></textarea>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">שליחת הודעות אוטומטית</label>
											<div class="controls">
												<div class="switch switch-small">
													<input type="checkbox" checked class="toggle"/>
												</div>
											</div>
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue"><i class="icon-ok"></i> שמור </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<!-- END SAMPLE FORM PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="manual-messages1">
						<div class="span12">
							<!-- BEGIN SAMPLE FORM PORTLET-->   
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="icon-envelope"></i>
										<span class="hidden-480">שליחת הודעה יזומה</span>
									</div>
								</div>
								<div class="portlet-body form">
									<!-- BEGIN FORM-->
									<form action="#" class="form-horizontal">
										<div class="row-fluid">
											<div class="span4">
												<div class="control-group ido-inline">
													<label class="control-label">שליחת הודעה</label>
													<div class="controls">
														<select class="span2 chosen" data-placeholder="">
															<option value="0">יום ראשון</option>
															<option value="1">יום שני</option>
															<option value="2">יום שלישי</option>
															<option value="3">יום רביעי</option>
															<option value="4">יום חמישי</option>
															<option value="5">יום שישי</option>
															<option value="6">יום שבת</option>
														</select>
														<select class="span2 chosen" data-placeholder="">
															<option value="0">00:00</option>
															<option value="1">01:00</option>
															<option value="2">02:00</option>
															<option value="3">03:00</option>
															<option value="4">04:00</option>
															<option value="5">05:00</option>
															<option value="6">06:00</option>
															<option value="7">07:00</option>
															<option value="8">08:00</option>
															<option value="9">09:00</option>
															<option value="10">10:00</option>
															<option value="11">11:00</option>
															<option value="12">12:00</option>
															<option value="13">13:00</option>
															<option value="14">14:00</option>
															<option value="15">15:00</option>
															<option value="16">16:00</option>
															<option value="17">17:00</option>
															<option value="18">18:00</option>
															<option value="19">19:00</option>
															<option value="20">20:00</option>
															<option value="21">21:00</option>
															<option value="22">22:00</option>
															<option value="23">23:00</option>
														</select>
														<textarea class="medium m-wrap span2" rows="3"></textarea>
													</div>
												</div>
											</div>
											
											<div class="span4">
												<div class="control-group ido-inline">
													<div class="controls">
														<div class="switch switch-small">
															<input type="checkbox" checked class="toggle"/>
														</div>
													</div>
												</div>
											</div>
											-->
										</div>
										<div class="form-actions">
											<button type="submit" class="btn blue"><i class="icon-ok"></i> שלח </button>
											<button type="button" class="btn">ביטול</button>
										</div>
									</form>
									<!-- END FORM-->  
								</div>
							</div>
							<!-- END SAMPLE FORM PORTLET-->
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="campaigns">
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box light-grey">
							<div class="portlet-title">
								<div class="caption"><i class="icon-globe"></i>העלאת קובץ חדש</div>
							</div>
							<div class="portlet-body">
								<div class="table-toolbar">
									<div class="btn-group">
										<button id="btn-upload-file" class="btn green">
											העלה קובץ <i class="icon-plus"></i>
										</button>
										<form action="/api/dataFileUpload/1" method="post" enctype="multipart/form-data" id="form-data-file-upload">
											<label for="file">Filename:</label>
											<input type="file" name="dataFile" id="dataFile"><br>
											<input type="text" name="text" id="text" value="some value"><br>
										</form>
									</div>
								</div>
							</div>
						</div>
					<!-- END EXAMPLE TABLE PORTLET-->
					</div>
					<div class="clearfix"></div>
					<div class="row-fluid" id="campaigns">
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box light-grey">
							<div class="portlet-title">
								<div class="caption"><i class="icon-globe"></i>ניהול הודעות</div>
							</div>
							<div class="portlet-body">
								<div class="table-toolbar">
									<div class="btn-group">
										<button id="add-new-campaign" class="btn green">
											Add New <i class="icon-plus"></i>
										</button>
									</div>
								</div>
								<table class="table table-striped table-bordered table-hover" id="scheduled-messages-table">
									<thead>
										<tr>
											<th data-field="is_active">סטטוס</th>
											<th data-field="name">שם</th>
											<th data-field="description">תיאור</th>
											<th data-field="day_of_week">יום בשבוע</th>
											<th data-field="hour">שעה</th>
											<th data-field="is_recurring">חזרה שבועית</th>
											<th data-field="message_text">הודעה</th>
											<th data-field="message_link">קישור</th>
											<th data-field="message_sound">צליל</th>
											<th>סינון</th>
											<th>מחיקה</th>
										</tr>
									</thead>
									<tbody></tbody>
								</table>
							</div>
						</div>
					<!-- END EXAMPLE TABLE PORTLET-->
					</div>
				</div>
			</div>
			<!-- END PAGE CONTAINER-->    
		</div>
		<!-- END PAGE -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	<div class="footer">
		<div class="footer-inner">
			2013 &copy; Metronic by keenthemes.
		</div>
	</div>
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->   
	<script src="assets/plugins/jquery-1.10.1.min.js" type="text/javascript"></script>
	<!--
	<script src="assets/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script> //removed for deployment
	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="assets/plugins/jquery-ui/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>      
	<script src="assets/plugins/bootstrap/js/bootstrap-rtl.min.js" type="text/javascript"></script>
	<!--
	<script src="assets/plugins/bootstrap-hover-dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript" ></script>
	<!--[if lt IE 9]>
	<script src="assets/plugins/excanvas.min.js"></script>
	<script src="assets/plugins/respond.min.js"></script>  
	<![endif]-->   
	
	<!--<script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>-->
	<script src="assets/plugins/jquery.blockui.min.js" type="text/javascript"></script>  

	<!--<script src="assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript" ></script>-->
	<!-- END CORE PLUGINS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<!--
	<script src="assets/plugins/flot/jquery.flot.js" type="text/javascript"></script>
	<script src="assets/plugins/flot/jquery.flot.resize.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery.pulsate.min.js" type="text/javascript"></script>
	<script src="assets/plugins/bootstrap-daterangepicker/date.js" type="text/javascript"></script>
	<script src="assets/plugins/bootstrap-daterangepicker/daterangepicker-rtl.js" type="text/javascript"></script>     
	<script src="assets/plugins/gritter/js/jquery.gritter.js" type="text/javascript"></script>
	<script src="assets/plugins/fullcalendar/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-easy-pie-chart/jquery.easy-pie-chart.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
	-->
	<script src="assets/plugins/bootstrap-switch/static/js/bootstrap-switch.js" type="text/javascript" ></script><!-- for ON/Off switch -->  
	
	 <script src="assets/plugins/mustache.js" type="text/javascript"></script> <!-- mustache -->
	 <script src="assets/plugins/jquery.ba-throttle-debounce.js" type="text/javascript"></script> <!-- jquery throtle -->
	
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!--<script src="assets/scripts/table-editable.js"></script>-->
	<script type="text/javascript" src="assets/plugins/bootstrap-toggle-buttons/static/js/jquery.toggle.buttons.js"></script>
	<!-- END PAGE LEVEL SCRIPTS -->
	
	<!-- BEGIN EDITABLE TABLE SCRIPTS (ido)-->
	<!--
	<script type="text/javascript" src="assets/plugins/select2/select2.min.js"></script>
	<script type="text/javascript" src="assets/plugins/data-tables/jquery.dataTables.js"></script>
	<script type="text/javascript" src="assets/plugins/data-tables/DT_bootstrap.js"></script>
	-->
	<!-- END EDITABLE TABLE SCRIPTS -->
	<!-- BEGIN IDO JS: -->
	<script type="text/javascript" src="js/jquery.jeditable.js"></script>
	<script type="text/javascript" src="js/jquery.blockui.js"></script>
	
	<!--NAVIGATION SCRIPT-->
	<script>
		$('.page-sidebar-menu li').on('click', function(){
			$('.page-sidebar-menu li').removeClass('active');
			$(this).addClass('active');
			
			$('#dashboard > .row-fluid').hide();
			var section = $(this).attr('data-section'); 
			$('#dashboard #' + section + '.row-fluid').fadeIn();
		});
		
		$(document).ready(function(){
			//$('.page-sidebar-menu li:first-child').trigger('click');
			$('.page-sidebar-menu li:last-child').trigger('click');
		});
	</script>

	<!--Loading Vendors-->
	<script>
		function appendVendorRow(manager) //for new vendor use vendor.id=0
		{
			var vendorData = $.extend({},manager,{
				"editableFields": [manager.vendor,manager.name,manager.phone,manager.email,manager.ivr_phone,manager.roost_url,manager.roost_config_key,manager.roost_secret_key,manager.redirect_url,manager.user_name,manager.password],
				"nodeMac": function(){return this.node_mac;},
				"nodeId": function(){return this.id;}
			});
			/*unnecessary thead in the nodes table (due to the table plugin)*/
			var vendorRow = Mustache.render('<tr class= "vendor" data-id="{{id}}">{{#editableFields}}<td class="editable"><input type="text" value="{{.}}"></td>{{/editableFields}}<td class="center"><span class="row-details row-details-close"></span> Nodes list<div class="hidden"><table class="table-bordered nodes" data-vendor-id="{{id}}"><thead><tr><th></th><th></th></tr></thead><tbody>{{#nodes}}<tr><td class="editable"><input type="text" value="{{nodeMac}}" data-node-id="{{nodeId}}"</td><td><a class="delete-node" href="#">Delete</a></td></tr>{{/nodes}}</tbody></table><div class="btn-group"><button class="btn green mini add-new-node">Add New <i class="icon-plus"></i></button></td></div></td><td><a id="delete-{{id}}" class="delete" href="#">Delete</a></td></tr>', vendorData);
			//if (!nodesList) {nodesList='';}   //DEAL WITH EMPTY NODES TABLE
			//if (vendor.id==-1) {} //DEAL WITH NEW ROWS
			$('#vendors-table > tbody').append(vendorRow);
			var currentRow = $('#vendors-table>tbody>tr:last-child');
			var id = currentRow.attr('data-id'); 
			if (id=="") {//saving the new row it will get an ID 
				$.ajax({
					type: "post",
					url: '/api/1/managers/',				
					data: managerData,
					success: function(response) {
						console.log(response);
						var newRow = $($('#vendors-table tr[data-id=""]')[0]);
						newRow.attr('data-id',response);
						newRow.find('table.nodes').attr('data-vendor-id',response);
						currentRow.on('keyup', 'input', $.debounce(2000, updateManager));//TODO I changed it here but not in the server now the server functions can be narrowed down :))
					}
				});
			}
			else{currentRow.on('keyup', 'input', $.debounce(2000, updateManager));}
		}
	</script>	
	
	<!--EDITTING VENDORS-->
	<script type="text/javascript">
		function updateManager(vendorId){
			var managerRow = $($(this).parents('tr.vendor')[0]); 
			var managerId = managerRow.attr('data-id');
			var nodes = {};
			var managerData = {};
			managerRow.find('table.nodes').find('input').each(function(index,item){
				var id = $(this).attr('data-node-id');
				if(id){nodes[index]={id:id,nodeMac:$(this).val()};}
				else{nodes[index]={nodeMac:$(this).val()};}
			});
			managerRow.children('td').children('input[type="text"]').each(function(index,item){
				var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
				managerData[fieldName] = $(this).val();
			});
			managerData['nodes']=nodes
			console.log(managerId);
			console.log(managerData);
			$.ajax({
				type: "post",
				url: '/api/1/managers/'+managerId,				
				data: managerData,
				success: function(response) {
					console.log(response);
				}
			});
		}
		function deleteVendor(){			//ERROR handling maybe also here reload the table
			var parentRow = $($(this).parents('tr')[0]);
			parentRow.fadeOut();
			var id = $(this).attr("id").replace("delete-", "");
			$.ajax({
				type: "delete",
				url: '/api/1/managers/'+id,				
				success: function(response) {
					if(response == id+'-Deleted') {}//do nothing
					else{} //error handling
				}
			});
		}	
		$(function() {
			$('#vendors-table').on("click",'a.delete', deleteVendor);
			$('.add-new-vendor').on('click', function(){
				var newVendor = {fullName: 'משתמש חדש'};
				appendVendorRow(newVendor);
			});			
		});
	</script>
	
	<!--EDITTING NODES-->
	<script>
		function toggleNodesTable(){
			$(this).toggleClass('row-details-close');
			$(this).toggleClass('row-details-open');
			$(this).next('div').toggleClass('hidden');
		}
		$(function(){
			$('#vendors-table').on('click','.row-details',toggleNodesTable);
			$('#vendors-table').on('click','.add-new-node',function(){
				var newNodeRow = '<tr><td class="editable"><input type="text" value="New node..." data-node-id=""</td><td><a class="delete-node" href="#">Delete</a></td></tr>'; //TODO : handle the node id- perhaps it is unnecessary...
				var nodesTable = $($(this).parents('div')[0]).prev('table.nodes');
				$(nodesTable.find('tbody')[0]).append(newNodeRow);	
			});
			$('table.nodes').on('click','a.delete-node',function(){
				var vendorId = $($(this).parents('table')[0]).attr('data-vendor-id');
				$(this).parents('tr')[0].remove();
				updateManager(vendorId);
				
			});
		});
	</script>
	<!--CAMPAIGNS -->
	<script>
	function prependCampaignRow(c){	 // return to prependCampaignRow(c, newRow)
		
		var newCampaign = {
			days: [
				{value:0, label:'ראשון'},
				{value:1, label:'שני'},
				{value:2, label:'שלישי'},
				{value:3, label:'רביעי'},
				{value:4, label:'חמישי'},
				{value:5, label:'שישי'},
				{value:6, label:'שבת'},
			],
			hours: [{value:0},{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7},{value:8},{value:9},{value:10},{value:11},{value:12},{value:13},{value:14},{value:15},{value:16},{value:17},{value:18},{value:19},{value:20},{value:21},{value:22},{value:23}],
			messageSounds:[{value:'0', label:'bell'},{value:1,label:'ring'},{value:2,label:'alarm'}],
		};
		$.extend(newCampaign,{id:c.id, isActive:c.is_active,messageText:c.message_text, messageLink:c.message_link, isRecurring:c.isRecurring, filters:c.filters, isCancelled:c.is_cancelled});
		$.extend(newCampaign.days[c.day_of_week],{isSelected:true});
		$.extend(newCampaign.hours[c.hour],{isSelected:true});
		$.extend(newCampaign.messageSounds[c.message_sound],{isSelected:true});
		console.log(newCampaign);
		var partials = {
			isActive: '<td><input type="checkbox" {{#isActive}}checked="checked"{{/isActive}} class="toggle"/></td>',
			dayOption:'<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{label}}</option>',
			hourOption:'<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{value}}:00</option>',
			soundOption: '<option value="{{value}}" {{#isSelected}}selected{{/isSelected}}>{{label}}</option>',
			isRecurring: '<td><input type="checkbox" {{#isRecurring}}checked="checked"{{/isRecurring}} class="toggle"/></td>',
			messageText: '<td><textarea>{{messageText}}</textarea></td>',
			messageLink: '<td><input type="text" value="{{messageLink}}"></td>',
			//filter:'{{#.}}{{name}}{{/.}}<select><option value="0">no filter</option>{{#.}}<option {{#isSelected}}selected{{/isSelected}}>{{value}}</option>{{/.}}</select>', //When we will filter values...
			filters:'<td><div>{{#filters}}<div>{{.}}</div>{{/filters}}</div></td>',
			deleteLink: '</td><td><a id="delete-{{id}}" class="delete" href="#">Delete</a></td>'
		};
		
		var campaignRow = Mustache.render('<tr class="campaign{{#isCancelled}} cancelled-campaign{{/isCancelled}}" data-id="{{id}}">{{>isActive}}<td ><select class="chosen">{{#days}}{{>dayOption}}{{/days}}</select></td><td><select class="chosen">{{#hours}}{{>hourOption}}{{/hours}}</select></td>{{>isRecurring}}{{>messageText}}{{>messageLink}}<td><select class="chosen">{{#messageSounds}}{{>soundOption}}{{/messageSounds}}</select></td>{{>filters}}{{>deleteLink}}</tr>', newCampaign,partials);

		$('#scheduled-messages-table tbody').prepend(campaignRow);		
		//TODO add nice toggle buttons to isRecurring

		var currentRow = $('#scheduled-messages-table>tbody>tr:first-child');
		var id = currentRow.attr('data-id'); 
		if (id=="") {//saving the new row it will get an ID 
			$.ajax({
				type: "post",
				url: '/api/1/campaigns/',				
				data: newCampaign,
				success: function(response) {
					console.log(response);
					var newRow = $($('#scheduled-messages-table tr[data-id=""]')[0]);
					newRow.attr('data-id',response);
					currentRow.on('keyup change', 'input,textarea,select', $.debounce(2000, updateCampaign));//TODO I changed it here but not in the server now the server functions can be narrowed down :))
				}
			});
		}
		else{currentRow.on('keyup change', 'input,textarea,select', $.debounce(2000, updateCampaign));}
	}	
	function updateCampaign(campaignId){
		var campaignRow = $($(this).parents('tr.campaign')[0]); 
		var campaignId = campaignRow.attr('data-id');		
		var campaignData = {};
		
		campaignRow.children('td').children('input[type="text"]').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		campaignRow.children('td').children('input[type="checkbox"]').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			if($(this).is(':checked')){campaignData[fieldName] = true;}
			else{campaignData[fieldName] = false;}
		});
		campaignRow.children('td').children('select').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		campaignRow.children('td').children('textarea').each(function(index,item){
			var fieldName = $(this).closest('table').find('th').eq($(this).parent().index()).attr('data-field') ;
			campaignData[fieldName] = $(this).val();
		});
		console.log(campaignRow);
		console.log('before send:');
		console.log(campaignId);
		console.log(campaignData);
		$.ajax({
			type: "post",
			url: '/api/1/campaigns/'+campaignId,				
			data: campaignData,
			success: function(response) {
				console.log(response);
			}
		});
	}

	/*
	$('#form-data-file-upload').submit(function(e){
	    var postData = $(this).serializeArray();
	    var formURL = $(this).attr("action");
	    $.ajax(
	    {
	        url : formURL,
	        type: "POST",
	        data : postData,
	        success:function(data, textStatus, jqXHR) 
	        {
	            //data: return data from server
	            alert(data);
	        },
	        error: function(jqXHR, textStatus, errorThrown) 
	        {
	            //if fails      
	            alert(textStatus);
	        }
	    });
	    e.preventDefault(); //STOP default action
	});
*/
	$(function(){
		$('#add-new-campaign').on('click',function(){
			var newCampaign = {day:0,hour:12,text:"הודעה חדשה",is_recurring:0};
			prependCampaignRow(newCampaign, window.newCampaignRow);
		});
		$('#scheduled-messages-table').on('click','a.delete-campaign',function(){
			$(this).parents('tr')[0].remove();
			updateManagerCampaigns();
		});		
		//$('#scheduled-messages-table').on('change','select, input[type="checkbox"]',$.debounce(2000, updateManagerCampaigns));		
		//$('#scheduled-messages-table').on('keyup','textarea',$.debounce(2000, updateManagerCampaigns));		

		
		$.ajax({
			type: "get",
			url: '/api/1/managers/',				
			success: function(response) {$.each(response,function(index,manager){
				appendVendorRow(manager);
			});}	
		});

		//Getting manager's campaigns:
		var managerId = getParameterByName('managerId');
		$.ajax({
			type:"get",
			url:'api/1/campaigns/'+managerId, //TODO dynamic managerId  //TODO very bad loop fix with Ilan
			success: function(campaigns){
				console.log('hey');
				console.log(campaigns);
				$.each(campaigns,function(index,c){prependCampaignRow(c);});
			},
			error:function(){console.log('b');}
		});

		$('#btn-upload-file').on('click',function(){
			$('#form-data-file-upload').submit();
//			$.post('/api/dataFileUpload',$('#form-data-file-upload').serialize(),function(response){alert(response);});
		});
	});

	function getParameterByName(name) {
	    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
	    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	        results = regex.exec(location.search);
	    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
	</script>
	<!-- Ido Styling -->
	<style type="text/css">
		.dataTable .row-details{width: auto; padding-left: 18px;}
		#dashboard > .row-fluid{display:none;}
		#dashboard #managers.row-fluid{min-width: 51.46em;}
		table.nodes thead{display:none;}
		tr.now-deleting{display:none;}
		tr[data-id="-1"] > td {background-color:yellow !important;}
		tr[data-id="-1"] > td > .row-details {display: none;}
		table#scheduled-messages-table td{text-align: center;}
		table#scheduled-messages-table tr.cancelled-campaign a.delete{display:none;}
		table#scheduled-messages-table tr.cancelled-campaign td:first-child input:after{content:"dead";}
		input[type="text"]{width: auto;}

		/*temp (solve problem of 2 large managers table */
		.portlet-body{overflow: auto;}
		
	/*scheaduled messages*/
	
	</style>
	<!-- Ido Styling END-->
	
	<!-- new plugin End-->
	
	<!-- END JAVASCRIPTS -->
	
</body>
<!-- END BODY -->
</html>